{{ define "main" }}

{{/* === –ó–∞–≥—Ä—É–∂–∞–µ–º CSV —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —Ü–µ–Ω–∞–º–∏ –∏ –æ—Å—Ç–∞—Ç–∫–∞–º–∏ === */}}
{{ $csv := resources.Get "products.csv" | transform.Unmarshal }}
{{ $map := dict }}
{{ range $csv }}
  {{ $map = merge $map (dict (lower (index . 1)) (dict "price" (index . 2) "in_stock" (index . 3))) }}
{{ end }}

<div class="layout-content-container flex flex-col max-w-[1280px] flex-1 mx-auto">

  <!-- Hero-—Å–µ–∫—Ü–∏—è -->
  <section class="@container @[480px]:p-4">
    <div class="flex min-h-[280px] flex-col gap-6 bg-cover bg-center bg-no-repeat @[280px]:gap-8 @[480px]:rounded-xl items-center justify-center p-4"
         style='background-image: linear-gradient(rgba(0, 0, 0, 0.1) 0%, rgba(0, 0, 0, 0.4) 100%), url("{{ "images/hero.jpg" | absURL }}");'>

      <div class="flex flex-col gap-2 text-center">
        <h1 class="text-white text-4xl font-black leading-tight tracking-[-0.033em] @[480px]:text-5xl">–°—Ç–∏–ª—å –∂–∏–∑–Ω–∏</h1>
        <h2 class="text-white text-sm font-normal @[480px]:text-base">
          –ü–æ–¥–±–æ—Ä–∫–∞ –≥–æ–±–µ–ª–µ–Ω–æ–≤—ã—Ö –∫–æ–≤—Ä–æ–≤ —Å —Ç–æ–ø–æ–≤—ã–º–∏ –∞–Ω–∏–º–µ.
        </h2>
      </div>
      <a href="https://t.me/wa_gi_ch"
         target="_blank" rel="noopener"
         aria-label="–ù–∞—à Telegram-–∫–∞–Ω–∞–ª"
         class="inline-flex min-w-[84px] max-w-[480px] items-center justify-center
                h-10 px-4 rounded-2xl bg-red-600 text-white text-sm
                font-medium italic tracking-wide
                hover:bg-red-700 hover:shadow-md active:scale-[0.98] transition">
        <!-- Telegram icon -->
        <svg aria-hidden="true" class="w-4 h-4 mr-2" viewBox="0 0 240 240" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
          <path d="M120 0C53.7 0 0 53.7 0 120s53.7 120 120 120 120-53.7 120-120S186.3 0 120 0zm56.6 83.5l-17.9 84.6c-1.3 6-4.9 7.5-10 4.7l-27.6-20.3-13.3 12.8c-1.5 1.5-2.8 2.8-5.7 2.8l2-28.7 52.3-47.3c2.3-2.1-.5-3.3-3.6-1.2l-64.6 40.7-27.8-8.7c-6-1.9-6.1-6-1.3-8.8l108.6-41.9c5.1-1.9 9.6 1.2 8 8.9z"/>
        </svg>
        –ù–∞—à&nbsp;–¢–ì–ö
      </a>
    </div>
  </section>

  <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
  <section class="mt-8 px-4 text-center text-neutral-700 text-base leading-relaxed">
    <p class="max-w-[720px] mx-auto">
      –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à —É—é—Ç–Ω—ã–π —É–≥–æ–ª–æ–∫ –∞–Ω–∏–º–µ-–¥–µ–∫–æ—Ä–∞! –ó–¥–µ—Å—å –≤—ã –Ω–∞–π–¥—ë—Ç–µ –≥–æ–±–µ–ª–µ–Ω—ã —Å –ª—é–±–∏–º—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º–∏ ‚Äî —Å—Ç–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —É–∫—Ä–∞—Å–∏—Ç—å –∫–æ–º–Ω–∞—Ç—É, –≤–¥–æ—Ö–Ω–æ–≤–∏—Ç—å—Å—è —ç—Å—Ç–µ—Ç–∏–∫–æ–π –∏ —Å–¥–µ–ª–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫ —Ñ–∞–Ω–∞—Ç—É.
      <br/>
      –í—Å–µ –≥–æ–±–µ–ª–µ–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤ –≤—ã—Å–æ–∫–æ–º –∫–∞—á–µ—Å—Ç–≤–µ, —Ä–∞–∑–º–µ—Ä ‚Äî <strong>160√ó130 —Å–º</strong>, –º–∞—Ç–µ—Ä–∏–∞–ª ‚Äî <strong>70% –ø–æ–ª–∏—ç—Å—Ç–µ—Ä –∏ 30% —Ö–ª–æ–ø–æ–∫</strong>.
    </p>
  </section>

  <!-- –ö–∞—Ç–∞–ª–æ–≥ -->
  <section id="catalog">
    <h2 class="text-[#141414] text-[22px] font-bold tracking-[-0.015em] px-4 pb-3 pt-10">–ö–∞—Ç–∞–ª–æ–≥ –∞–Ω–∏–º–µ-–≥–æ–±–µ–ª–µ–Ω–æ–≤</h2>
    <div class="grid grid-cols-2 md:grid-cols-3 gap-6 px-4">
      {{ range where .Site.RegularPages "Section" "tapestry" }}
        {{ $base := .File.BaseFileName | lower }}
        {{/* –í—ã–±–∏—Ä–∞–µ–º –Ω–æ—Ä–º–∞–ª—å–Ω—É—é –∏–ª–∏ soldout-–∫–∞—Ä—Ç–∏–Ω–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ */}}
        {{ $normal := resources.Get (print "images/" $base ".jpg") }}
        {{ $sold   := resources.Get (print "images/" $base "___soldout.jpg") }}
        {{ $instock := "0" }}
        {{ with index $map $base }}
          {{ $instock = printf "%v" (index . "in_stock") }}
        {{ end }}
        {{ $chosen := cond (ne $instock "0") $normal (or $sold $normal) }}

        <a href="{{ .RelPermalink }}" class="flex flex-col gap-2 rounded-xl overflow-hidden shadow hover:shadow-lg transition bg-white">
          {{ with $chosen }}
            {{ $resized := .Fit "400x500" }}
            <div
              class="w-full bg-center bg-no-repeat bg-cover aspect-[4/5]"
              style='background-image: url("{{ $resized.RelPermalink }}");'>
            </div>          
		  {{ else }}
            <div class="w-full bg-gray-200 flex items-center justify-center aspect-[4/5]">
              <span class="text-gray-500 text-sm">‚õî –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
            </div>
          {{ end }}

          <div class="p-3">
            <h3 class="text-[#141414] text-base font-semibold">{{ .Title }}</h3>
            {{ with index $map $base }}
              <p class="text-neutral-500 text-sm">üí∞ {{ .price }}‚ÇΩ</p>
            {{ else }}
              <p class="text-gray-400 text-sm">–¶–µ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞</p>
            {{ end }}
          </div>
        </a>
      {{ end }}
    </div>
  </section>

</div>
{{ end }}
